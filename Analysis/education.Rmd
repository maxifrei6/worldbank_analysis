---
title: "Worldbank Education Analysis"
author: "Maximilian Frei"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---

## Introduction
This analysis explores relationships between indicators such as central government debt, labor force education levels, and pupil-teacher ratios using World Bank data. It is divided into two main parts:  

1. Relationship between central government debt and labor force education.  
2. Relationship between labor force education and pupil-teacher ratios, focusing on implications for education quality.
<br>
<br>
```{r setup, message=FALSE, echo = FALSE}
# Load necessary libraries
library(dplyr)
library(ggplot2)
library(tidyr)

# Load the dataset
data_merged <- readRDS("/Users/maximilian/Desktop/wb_local/Data/Processed/data_merged.RDS")
data_grouped <- readRDS("/Users/maximilian/Desktop/wb_local/Data/Processed/data_grouped.RDS")
data_education <- left_join(data_merged, data_grouped, by = c("Country Name", "Country Code"))

# Add new column 'decade' as an ordered factor
data_education <- data_education %>%
  mutate(
    decade = case_when(
      Year <= 2009 ~ "2000s", # 2000 - 2009
      Year <= 2019 ~ "2010s", # 2010 - 2019
      TRUE ~ "2020s"          # 2020 and later
    ),
    # Convert 'decade' to an ordered factor with levels 2020s > 2010s > 2000s
    decade = factor(
      decade,
      levels = c("2000s", "2010s", "2020s"),
      ordered = TRUE
    )
  )


```

### 1 Central Government Debt and Labor Force Education
We analyze whether countries with higher central government debt as a percentage of GDP have lower percentages of labor force with basic education.
<br>
<br>
```{r scatter-debt-education, echo = FALSE, , warning=FALSE, message=FALSE}
# Scatter plot: Central government debt vs labor force with basic education
ggplot(data_education, aes(x = GC.DOD.TOTL.GD.ZS, y = SL.TLF.BASC.ZS)) +
  geom_point(alpha = 0.7, size = 3) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  labs(
    title = "Central Government Debt vs Labor Force with Basic Education",
    x = "Central Government Debt (% of GDP)",
    y = "Labor Force with Basic Education (%)"
  ) +
  theme_minimal()
```

<br>

```{r, echo = FALSE}

print("Count of missing data points and share of total data points by income level")
data_education %>%
  group_by(income_level) %>%
  summarise(
    total_rows = n(),
    missing_debt = sum(is.na(GC.DOD.TOTL.GD.ZS)),
    missing_debt_share = round((missing_debt / total_rows) * 100, 2),
    missing_education = sum(is.na(SL.TLF.BASC.ZS)),
    missing_education_share = round((missing_education / total_rows) * 100, 2)
  ) %>%
  as.data.frame() # Ensure full output display

```

<br>

```{r scatter-debt-education-years, echo = FALSE, , warning=FALSE, message=FALSE}
# Scatter plot: Central government debt vs labor force with basic education
ggplot(data_education, aes(x = GC.DOD.TOTL.GD.ZS, y = SL.TLF.BASC.ZS, color = Year)) +
  geom_point(alpha = 0.7, size = 3) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  facet_wrap(~ Year) +
  labs(
    title = "Central Government Debt vs Labor Force with Basic Education",
    x = "Central Government Debt (% of GDP)",
    y = "Labor Force with Basic Education (%)",
    color = "Year"
  ) +
  theme_minimal()
```

<br>

```{r scatter-debt-education-decades, echo = FALSE, , warning=FALSE, message=FALSE}
# Scatter plot: Central government debt vs labor force with basic education
ggplot(data_education, aes(x = GC.DOD.TOTL.GD.ZS, y = SL.TLF.BASC.ZS, color = decade)) +
  geom_point(alpha = 0.7, size = 3) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  facet_wrap(~ decade, ncol = 2) +
  labs(
    title = "Central Government Debt vs Labor Force with Basic Education",
    x = "Central Government Debt (% of GDP)",
    y = "Labor Force with Basic Education (%)",
    color = "decade"
  ) +
  theme_minimal()
```

### Interpretation 
At first glance we can observe a positive correlation between debt and education quality which has been stable across all time frames. The high proportion of missing data begs for further exploration. 
Next we will look at how this relationship differs if we group the observation based on income levels

<br>

```{r scatter-debt-education-income-lvls, echo = FALSE, , warning=FALSE, message=FALSE}
# Scatter plot: Central government debt vs labor force with basic education
ggplot(data_education, aes(x = GC.DOD.TOTL.GD.ZS, y = SL.TLF.BASC.ZS, color = income_level)) +
  geom_point(alpha = 0.7, size = 3) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  labs(
    title = "Central Government Debt vs Labor Force with Basic Education",
    x = "Central Government Debt (% of GDP)",
    y = "Labor Force with Basic Education (%)",
    color = "income level"
  ) +
  theme_minimal()
```

<br>

#### Further questions and interpretations:

- High income countries can be further divided into high income/low debt & high income/high debt where latter seems to result in higher basic education  
- Overall trend: higher debt % positively correlates with higher % of basic education  
- medium income countries seem to suggest an opposite trend  
- High share of missing data, predominantely for low income countries

<br>
```{r scatter-debt-education-facet, echo = FALSE, message=FALSE, warning=FALSE}
# Faceted scatter plot: Debt vs Education by Income Level
ggplot(data_education, aes(x = GC.DOD.TOTL.GD.ZS, y = SL.TLF.BASC.ZS, color = income_level)) +
  geom_point(alpha = 0.7, size = 3) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  facet_wrap(~ income_level) +
  labs(
    title = "Central Government Debt vs Labor Force with Basic Education by Income Level",
    x = "Central Government Debt (% of GDP)",
    y = "Labor Force with Basic Education (%)",
    color = "Income Level"
  ) +
  theme_minimal() +
  theme(strip.text = element_text(face = "bold"))

print("Calculating correlation coefficients and data pair counts for each income level")
data_education %>%
  group_by(income_level) %>%
  summarise(
    correlation = cor(GC.DOD.TOTL.GD.ZS, SL.TLF.BASC.ZS, use = "complete.obs"),
    data_pairs = sum(complete.cases(GC.DOD.TOTL.GD.ZS, SL.TLF.BASC.ZS))  # Count of valid data pairs
  )

```
<br>

### Exploration of medium income countries
To explore why medium-income countries show an opposite (negative) trend in the relationship between central government debt and labor force education, we should consider a deeper analysis into factors that might drive this behavior.
<br>
<br>

```{r group-by-population-size, echo = FALSE, message=FALSE, warning=FALSE}

ggplot(data_education %>% filter(income_level == "Medium"),
       aes(x = GC.DOD.TOTL.GD.ZS, y = SL.TLF.BASC.ZS, color = population_size)) +
  geom_point(alpha = 0.7, size = 3) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Debt vs Education by Population Size (Medium-Income Countries)",
    x = "Central Government Debt (% of GDP)",
    y = "Labor Force with Basic Education (%)",
    color = "Population Size"
  ) +
  theme_minimal()

print("Calculating correlation coefficients and data pair counts for each population size")
data_education %>%
  filter(income_level == "Medium") %>%
  group_by(population_size) %>%
  summarise(
    correlation = cor(GC.DOD.TOTL.GD.ZS, SL.TLF.BASC.ZS, use = "complete.obs"),
    data_pairs = sum(complete.cases(GC.DOD.TOTL.GD.ZS, SL.TLF.BASC.ZS))  # Count of valid data pairs
  )

```
<br>
**High Population Countries:**  

- Exhibit a strong negative correlation (-0.929) between debt and labor force education.  
- Interpretation: Larger countries may face challenges in allocating resources effectively to education despite increasing debt levels.
  
**Medium Population Countries:**  

- Show a moderate negative correlation (-0.704).  
- Interpretation: These countries may have mixed capacities to use debt effectively, possibly due to regional or governance differences.

**Low Population Countries:**  

- barely represented in medium income countries  
<br>

```{r group-by-population-density, echo = FALSE, warning=FALSE, message=FALSE}
ggplot(data_education %>% filter(income_level == "Medium"),
       aes(x = GC.DOD.TOTL.GD.ZS, y = SL.TLF.BASC.ZS, color = population_density)) +
  geom_point(alpha = 0.7, size = 3) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Debt vs Education by Population Density (Medium-Income Countries)",
    x = "Central Government Debt (% of GDP)",
    y = "Labor Force with Basic Education (%)",
    color = "Population Density"
  ) +
  theme_minimal()

print("Calculating correlation coefficients and data pair counts for each population density")
data_education %>%
  filter(income_level == "Medium") %>%
  group_by(population_density) %>%
  summarise(
    correlation = if (sum(!is.na(GC.DOD.TOTL.GD.ZS) & !is.na(SL.TLF.BASC.ZS)) >= 2) {
      cor(GC.DOD.TOTL.GD.ZS, SL.TLF.BASC.ZS, use = "complete.obs")
    } else {
      NA
    },
    data_pairs = sum(complete.cases(GC.DOD.TOTL.GD.ZS, SL.TLF.BASC.ZS))  # Count of valid data pairs
  )

```
<br>

**High Population Density:**  

- no medium income countries with high population density

**Medium Population Density:**  

- Trends are unclear, with little visible clustering of data points.  
- This group might represent countries with varying economic and governance conditions.  

**Low Population Density:**  

- Exhibit a strong negative trend, with labor force education decreasing as debt increases.  
- Interpretation: In sparsely populated areas, education infrastructure may be costly to maintain or expand, leading to less effective debt utilization.  

<br>
```{r longitudinal_plot, fig.height=8, fig.width=12, echo=FALSE, warning=FALSE, message=FALSE}


# Filter countries with more than 4 non-NA entries for SL.TLF.BASC.ZS
data_filtered <- data_education %>%
  filter(income_level == "Medium") %>%
  group_by(`Country Name`) %>%
  filter(sum(!is.na(SL.TLF.BASC.ZS)) > 4) %>%  # Keep countries with more than 4 non-NA entries
  ungroup()

# Convert Year column to numeric
data_filtered <- data_filtered %>%
  mutate(Year = as.numeric(as.character(Year)))

# Faceted line chart with subtle trend lines and simplified x-axis
ggplot(data_filtered, 
       aes(x = Year, y = SL.TLF.BASC.ZS, color = population_size)) +
  geom_line(aes(group = `Country Name`), alpha = 0.8, size = 0.7) +  # Line chart
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed", size = 0.8, color = "grey50", alpha = 0.6) +  # Subtle trend line
  facet_wrap(~ `Country Name`, scales = "free_y") +  # Facet by country
  scale_x_continuous(breaks = seq(2000, 2020, 5)) +  # Simplify x-axis breaks
  labs(
    title = "Education Trends Over Time by Country (Medium-Income Countries with >4 Non-NA Entries)",
    x = "Year",
    y = "Labor Force with Basic Education (%)",
    color = "Population Size"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 18, face = "bold", hjust = 0.5),  # Bigger and centered title
    strip.text = element_text(size = 8, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels
    legend.position = "bottom"
  )

# Calculate range of basic education percentage for each country
country_variability <- data_filtered %>%
  filter(!is.na(SL.TLF.BASC.ZS)) %>%  # Remove missing values
  group_by(`Country Name`) %>%
  summarise(
    min_education = min(SL.TLF.BASC.ZS, na.rm = TRUE),
    max_education = max(SL.TLF.BASC.ZS, na.rm = TRUE),
    range_education = max_education - min_education
  )

# View the results
print(country_variability)

```
<br>

#### Interpretations  
- insufficient data for most countries
- overall % with basic education drastically decreasing among filtered countries
- high fluctuation and variability in measurements questioning data quality
- sparsely populated countries have difficulty of achieving and maintaining of high education standards

### 2 Labor Force Education and Pupil-Teacher ratios

In our previous analysis we highlighted sparsely populated countries that struggle with overall education quality. One driving factor in this might be pupil-teacher ratios.

<br>
For this we first look at the general relationship between basic education and pupil-teacher ratios:

```{r, message=FALSE, warning=FALSE, echo=FALSE}
# Scatter plot: pupil-teacher ratios vs labor force with basic education
ggplot(data_education, aes(x = SE.TER.ENRL.TC.ZS, y = SL.TLF.BASC.ZS, color = population_density)) +
  geom_point(alpha = 0.7, size = 3) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  labs(
    title = "Pupil-Teacher Ratio vs Labor Force with Basic Education",
    x = "Pupil-Teacher Ratio",
    y = "Labor Force with Basic Education (%)",
    color = "Population density"
  ) +
  theme_minimal()
```

- densely populated countries tend to have better education quality
- sparsely populated countries tend to have lower pupil-teacher ratios
- variability in education quality decreases as pupil-teacher ratios increase
- small positive relationship between both variables

<br>
```{r, message=FALSE, warning=FALSE, echo=FALSE}
# Scatter plot: pupil-teacher ratios vs labor force with basic education
ggplot(data_education, aes(x = SE.TER.ENRL.TC.ZS, y = SL.TLF.BASC.ZS, color = population_density)) +
  geom_point(alpha = 0.7, size = 3) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  facet_wrap(~ population_density) +
  labs(
    title = "Pupil-Teacher Ratio vs Labor Force with Basic Education",
    x = "Pupil-Teacher Ratio",
    y = "Labor Force with Basic Education (%)",
    color = "Population density"
  ) +
  theme_minimal()
```
<br>

- densely populated countries tend to achieve better education with less pupils per teacher indicating higher monetary power

<br>
```{r, message=FALSE, warning=FALSE, echo=FALSE}
# Scatter plot: pupil-teacher ratios vs labor force with basic education
ggplot(data_education, aes(x = SE.TER.ENRL.TC.ZS, y = SL.TLF.BASC.ZS, color = income_level)) +
  geom_point(alpha = 0.7, size = 3) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  facet_wrap(~ income_level) +
  labs(
    title = "Pupil-Teacher Ratio vs Labor Force with Basic Education",
    x = "Pupil-Teacher Ratio",
    y = "Labor Force with Basic Education (%)",
    color = "Income Level"
  ) +
  theme_minimal()

data_education %>%
  group_by(income_level) %>%
  summarise(
    correlation = cor(SL.TLF.BASC.ZS, SE.TER.ENRL.TC.ZS, use = "complete.obs"),
    n = sum(complete.cases(SL.TLF.BASC.ZS, SE.TER.ENRL.TC.ZS))
  )
```

```{r, message=FALSE, warning=FALSE, echo=FALSE}
# Scatter plot: pupil-teacher ratios vs labor force with basic education
ggplot(data_education, aes(x = SE.TER.ENRL.TC.ZS, y = SL.TLF.BASC.ZS, color = population_size)) +
  geom_point(alpha = 0.7, size = 3) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  facet_wrap(~ population_size) +
  labs(
    title = "Pupil-Teacher Ratio vs Labor Force with Basic Education",
    x = "Pupil-Teacher Ratio",
    y = "Labor Force with Basic Education (%)",
    color = "Population Size"
  ) +
  theme_minimal()
```

```{r, warning=FALSE, message=FALSE, echo=FALSE}
ggplot(data_education, aes(x = NY.GDP.PCAP.PP.KD, y = SL.TLF.BASC.ZS, color = income_level)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_log10() +  # Apply log10 transformation to the x-axis
  labs(
    title = "GDP per Capita vs Labor Force with Basic Education (Log Scale)",
    x = "GDP per Capita (Log Scale, USD)",
    y = "Labor Force with Basic Education (%)"
  ) +
  theme_minimal()
```
<br>
<br>
**High-Income Countries:**  

- The relationship between GDP per capita and labor force with basic education (%) is strongly positive, as evidenced by the steep slope for high-income countries.  
- High-income countries are concentrated at the higher end of the GDP scale.  

**Medium-Income Countries:**  

- Medium-income countries appear to have a much flatter relationship, with some variability in education outcomes across a wide range of GDP values.  

**Low-Income Countries:**  

- Low-income countries show a slightly negative or flat trend between GDP per capita and education levels.  
- These countries are clustered toward the lower GDP range, with varying education outcomes.  

