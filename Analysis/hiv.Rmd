---
title: "Worldbank HIV Analysis"
author: "Leonie Mertes"
date: "`r Sys.Date()`"
output:
  html_document: default
---

## Introduction
This analysis explores relationships of HIV prevalence in the population aged 15-49 to the total alcohol consumption per capita as well as its coherence to percentage of labor force with basic education. Therefore we have two main parts:

1. How does the HIV prevalence in the population aged 15-49 relate to the total alcohol consumption per capita?
2. Do countries with higher percentage of labor force with basic education have lower HIV prevalence rates in the 15-49 population?
<br>
<br>
```{r setup, message = FALSE, echo = FALSE}
# Load necessary libraries
library(dplyr)
library(ggplot2)

# Load the dataset
data_merged <- readRDS("C:/Users/Leonie/Documents/Studium/3. Semester/Statsoft/worldbank_analysis/Data/Processed/data_merged.RDS")
data_grouped <- readRDS("C:/Users/Leonie/Documents/Studium/3. Semester/Statsoft/worldbank_analysis/Data/Processed/data_grouped.RDS")
data_processed <- left_join(data_merged, data_grouped, by = c("Country Name", "Country Code"))
data_hiv <- data_processed %>% 
  select(`Country Name`, `Country Code`, Year, SH.DYN.AIDS.ZS, SH.ALC.PCAP.LI, SL.TLF.BASC.ZS, alc_consumption, edu_basic)
```

### 1. HIV Prevalence and alcohol consumption
<br>
To take a look at the grouping of our data by alcohol consumption, we will display a plot of the most recent data in Year 2020.
```{r, echo=FALSE}
data_hiv %>%
  filter(Year == 2020) %>%
  ggplot(aes(`Country Name`, SH.ALC.PCAP.LI, colour = alc_consumption)) +
  geom_point() +
  labs(
    y = "Alkoholkonsum in Litern pro Kopf",
    x = "Land",
    title = "Gruppierung der Daten im Jahr 2020",
    colour = "verhältnismäßiger Alkoholkonsum"
  ) +
  theme(axis.text.x = element_text(
    angle = 45,
    hjust = 1,
    size = 4
  ))
```
Maybe its possible to group data for each year?
<br>
Now we take a look at the Comparison of alcohol consumption and HIV prevalence in 2020. Therefore we group by the relative alcohol consumption.
```{r, echo=FALSE}
data_hiv %>%
  filter(Year == 2020) %>%
  group_by(alc_consumption) %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS, colour = alc_consumption)) +
  geom_point() +
  labs(
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz in %",
    title = "Alkoholkonsum vs. HIV Prävalenz im Jahr 2020",
    colour = "relativer Alkoholkonsum"
  ) +
  geom_smooth(aes(group = 1), method = "lm", se = FALSE)
```
In the following we view the same plot, but without the extreme value. Therefore the country Tanzania is removed.
```{r, echo=FALSE}
data_hiv %>%
  filter(Year == 2020) %>%
  filter(`Country Name` != "Tanzania") %>%
  group_by(alc_consumption) %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS, colour = alc_consumption)) +
  geom_point() +
  labs(
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz in %",
    title = "Alkoholkonsum vs. HIV Prävalenz im Jahr 2020",
    colour = "relativer Alkoholkonsum"
  ) +
  geom_smooth(aes(group = 1), method = "lm", se = FALSE)
```
Now we view only one dot per category of relative alcohol consumption
```{r, echo=FALSE}
data_hiv %>%
  filter(Year == 2020) %>%
  group_by(alc_consumption) %>%
  summarise(
    alc_consumption = alc_consumption,
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SH.ALC.PCAP.LI = mean(SH.ALC.PCAP.LI, na.rm = TRUE)
  ) %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS, colour = alc_consumption)) +
  geom_point() +
  labs(
    title = "Alkoholkonsum vs. HIV Prävalenz im Jahr 2020",
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz",
    colour = "relativer Alkoholkonsum"
  ) +
  geom_smooth(aes(group = 1), method = "lm", se = FALSE)  
```
Now again without the extreme value of Tanzania
```{r, echo=FALSE}
data_hiv %>%
  filter(Year == 2020) %>%
  filter(`Country Name` != "Tanzania") %>% 
  group_by(alc_consumption) %>%
  summarise(
    alc_consumption = alc_consumption,
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SH.ALC.PCAP.LI = mean(SH.ALC.PCAP.LI, na.rm = TRUE)
  ) %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS, colour = alc_consumption)) +
  geom_point() +
  labs(
    title = "Alkoholkonsum vs. HIV Prävalenz im Jahr 2020",
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz",
    colour = "relativer Alkoholkonsum"
  ) +
  geom_smooth(aes(group = 1), method = "lm", se = FALSE)  
```
To get a better overview we take a look at all years.
```{r, echo = FALSE}
data_hiv %>% 
  group_by(Year, alc_consumption) %>% 
  summarise(SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
            SH.ALC.PCAP.LI = mean(SH.ALC.PCAP.LI, na.rm = TRUE),
            .groups = "drop") %>%
  ggplot(aes(Year, SH.DYN.AIDS.ZS, colour = alc_consumption)) +
  geom_point() +
  geom_line(aes(group = alc_consumption)) +
  theme(axis.text.x = element_text(
    angle = 45,
    hjust = 1,
    size = 6
  )) +
  labs(
    title = "HIV Prävalenz über die Jahre",
    x = "Jahr",
    y = "HIV Prävalenz",
    colour = "relativer Alkoholkonsum"
  ) 
```
(bringt nichts!
Now we want to take a more precise look at the connection of HIV Prevalence and alcohol consumption. Therefore we facet over year.)


