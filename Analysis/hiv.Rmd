---
title: "Worldbank HIV Analysis"
author: "Leonie Mertes"
date: "`r Sys.Date()`"
output:
  html_document: default
---

## Introduction
This analysis explores relationships of HIV prevalence in the population aged 15-49 to the total alcohol consumption per capita as well as its coherence to percentage of labor force with basic education. Therefore we have two main parts:
<br>
1. How does the HIV prevalence in the population aged 15-49 relate to the total alcohol consumption per capita?
<br>
2. Do countries with higher percentage of labor force with basic education have lower HIV prevalence rates in the 15-49 population?
<br>
<br>
```{r hiv_setup, message = FALSE, echo = FALSE, warning = FALSE}
# Load necessary libraries
library(here)
library(dplyr)
library(ggplot2)
library(tidyr)
library(RColorBrewer)

source(here("Scripts", "functions.R"))

# Load the dataset
data_merged <- readRDS(here("Data", "Processed", "data_merged.RDS"))
data_grouped <- readRDS(here("Data", "Processed", "data_grouped.RDS"))
data_processed <- left_join(data_merged, data_grouped, by = c("Country Name", "Country Code"))
data_hiv <- data_processed %>%
  select(
    `Country Name`,
    `Country Code`,
    Year,
    SH.DYN.AIDS.ZS,
    SH.ALC.PCAP.LI,
    SL.TLF.BASC.ZS,
    cat_alc,
    cat_education
  )

## HIV Variable:  Prevalence of HIV, total (% of population ages 15-49)
#                 SH.DYN.AIDS.ZS

#                 Total alcohol consumption per capita
#                 (liters of pure alcohol, projected estimates, 15+ years of age)
#                 SH.ALC.PCAP.LI

#                 Labor force with basic education
#                 (% of total working-age population with basic education)
#                 SL.TLF.BASC.ZS
```
<br>
Check how many NA's are in HIV, alcohol and education variable each Year (excluding years existing only of NA's)
<br>
```{r hiv_1, echo=FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_table <- data_hiv %>%
  group_by(Year) %>%
  reframe(
    num_na_hiv = sum(is.na(SH.DYN.AIDS.ZS)),
    num_na_alc = sum(is.na(SH.ALC.PCAP.LI)),
    num_na_edu = sum(is.na(SL.TLF.BASC.ZS))
  ) %>%
  filter(num_na_hiv < 25 & num_na_alc < 25 & num_na_edu < 25)
print(data_table)
```
<br> 
Auffällig ist, dass es überhaupt keine Daten für Aruba zu geben scheint, daher wird dieses Land im folgenden aus dem Datensatz entfernt, den wir für diese Fragestellung brauchen. Außerdem gibt es keine Daten für den Alkoholkonsum im Jahr 2021.
<br>
```{r hiv_2, echo=FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_hiv <- data_hiv %>%
  filter(`Country Name` != "Aruba")
data_alc <- data_hiv %>%
  filter(Year %in% data_table$Year)
```
<br>
<br>
### 1. HIV Prevalence and alcohol consumption
<br>
Als erstes wollen wir uns die existenten Daten über die relevanten Variablen anschauen.
<br>
```{r hiv_3, echo=FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc %>% 
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS)) +
  geom_point(size = 3, alpha = 0.7) +
  labs(
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz in %",
    title = "Alkoholkonsum vs. HIV Prävalenz"
  ) +
  theme_bw()
```
<br>
Nun schauen wir uns die Gruppierung dieser Daten im Allgemeinen an.
<br>
```{r hiv_4, echo=FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS ,colour = cat_alc)) +
  geom_point(size = 3, alpha = 0.7) +
  labs(
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz in %",
    title = "Gruppierung der Daten",
    subtitle = "Allgemeine Gruppierung",
    colour = "relativer Alkoholkonsum"
  ) +
  theme_bw() +
  scale_colour_brewer(palette = "Set2")
```
<br>
To take a look at the grouping of our data by alcohol consumption, we will display a plot of the most recent data in Year 2020.
<br>
```{r hiv_5, echo=FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc %>%
  filter(Year == 2020) %>%
  ggplot(aes(`Country Name`, SH.ALC.PCAP.LI, colour = cat_alc)) +
  geom_point(size = 3, alpha = 0.7) +
  labs(
    y = "Alkoholkonsum in Litern pro Kopf",
    x = "Land",
    title = "Gruppierung der Daten im Jahr 2020",
    colour = "relativer Alkoholkonsum"
  ) +
  theme_bw() +
  theme(axis.text.x = element_text(
    angle = 45,
    hjust = 1,
    size = 4
  )) +
  scale_colour_brewer(palette = "Set2")
```
<br>
Wie hier erkennbar ist, ist die Gruppierung nicht korrekt gerade für die Gruppen "Gering" und "Mittel". Die Alkoholvariable scheint über die Jahre wohl so zu variieren, dass eine jährliche Gruppierung sinvoll ist. Dem werden wir uns im späteren Verlauf dieses Skriptes annehmen.
<br>
Now we take a look at the Comparison of alcohol consumption and HIV prevalence in 2020. Therefore we group by the relative alcohol consumption.
<br>
```{r hiv_6, echo=FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc %>%
  filter(Year == 2020) %>%
  group_by(cat_alc) %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS, colour = cat_alc)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_bw() +
  labs(
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz in %",
    title = "Alkoholkonsum vs. HIV Prävalenz im Jahr 2020",
    colour = "relativer Alkoholkonsum"
  ) +
  geom_smooth(aes(group = 1), method = "lm", se = FALSE) +
  scale_colour_brewer(palette = "Set2")
```
<br>
In the following we view the same plot, but without the extreme value. Therefore the country Tanzania is removed. (only for interest, how relations are moved)
<br>
```{r hiv_7, echo=FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc %>%
  filter(Year == 2020) %>%
  filter(`Country Name` != "Tansania") %>%
  group_by(cat_alc) %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS, colour = cat_alc)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_bw() +
  labs(
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz in %",
    title = "Alkoholkonsum vs. HIV Prävalenz im Jahr 2020",
    colour = "relativer Alkoholkonsum"
  ) +
  geom_smooth(aes(group = 1), method = "lm", se = FALSE) +
  scale_colour_brewer(palette = "Set2")
```
<br>
Now we view only one dot per category of relative alcohol consumption.
<br>
```{r hiv_8, echo=FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc %>%
  filter(Year == 2020) %>%
  group_by(cat_alc) %>%
  summarise(
    cat_alc = cat_alc,
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SH.ALC.PCAP.LI = mean(SH.ALC.PCAP.LI, na.rm = TRUE)
  ) %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS, colour = cat_alc)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_bw() +
  labs(
    title = "Alkoholkonsum vs. HIV Prävalenz im Jahr 2020",
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz",
    colour = "relativer Alkoholkonsum"
  ) +
  geom_smooth(aes(group = 1), method = "lm", se = FALSE) +
  scale_colour_brewer(palette = "Set2")
```
<br>
Just for testing again without the extreme value of Tanzania
<br>
```{r hiv_9, echo=FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc %>%
  filter(Year == 2020) %>%
  filter(`Country Name` != "Tansania") %>%
  group_by(cat_alc) %>%
  summarise(
    cat_alc = cat_alc,
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SH.ALC.PCAP.LI = mean(SH.ALC.PCAP.LI, na.rm = TRUE)
  ) %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS, colour = cat_alc)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_bw() +
  labs(
    title = "Alkoholkonsum vs. HIV Prävalenz im Jahr 2020",
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz",
    colour = "relativer Alkoholkonsum"
  ) +
  geom_smooth(aes(group = 1), method = "lm", se = FALSE) +
  scale_colour_brewer(palette = "Set2")
```
<br>
To get a better overview we take a look at all years.
<br>
```{r hiv_10, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_hiv %>%
  group_by(Year, cat_alc) %>%
  summarise(
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SH.ALC.PCAP.LI = mean(SH.ALC.PCAP.LI, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  ggplot(aes(Year, SH.DYN.AIDS.ZS, colour = cat_alc)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_bw() +
  theme(axis.text.x = element_text(
    angle = 45,
    hjust = 1,
    size = 6
  )) +
  labs(
    title = "HIV Prävalenz über die Jahre",
    x = "Jahr",
    y = "HIV Prävalenz",
    colour = "relativer Alkoholkonsum"
  ) +
  scale_colour_brewer(palette = "Set2")
```
<br>
Now we take a look over the average of all years, where we categorize by relative alcohol consumption and compare to HIV Prevalence.
<br> 
```{r hiv_11, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_hiv %>%
  group_by(cat_alc) %>%
  summarise(SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
            .groups = "drop") %>%
  ggplot(aes(x = cat_alc, y = SH.DYN.AIDS.ZS)) +
  geom_col() +
  theme_bw() +
  labs(x = "relativer Alkoholkonsum",
    y = "HIV Prävalenz in %",
    title = "Alkoholkonsum vs. HIV Prävalenz im Schnitt über die Jahre")
```
<br>
to take a look at the categorization, we plot the same data in slightly different way:
<br>
```{r hiv_12, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_hiv %>%
  group_by(cat_alc) %>%
  summarise(
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SH.ALC.PCAP.LI = mean(SH.ALC.PCAP.LI, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS, colour = cat_alc)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_bw() +
  labs(
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz in %",
    title = "Alkoholkonsum vs. HIV Prävalenz im Schnitt über die Jahre",
    colour = "relativer Alkoholkonsum"
  ) +
  geom_smooth(aes(group = 1), method = "lm", se = FALSE) +
  scale_colour_brewer(palette = "Set2")
```
<br>
Wir wollen uns das Verhältnis pro Jahr anschauen und facetten deswegen nun über Jahr mit der allgemeinen Gruppierung.
<br>
```{r hiv_13, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_hiv %>%
  group_by(cat_alc) %>%
  ggplot(aes(x = cat_alc, y = SH.DYN.AIDS.ZS)) +
  geom_col() +
  facet_wrap(~ Year) +
  theme_bw() +
  theme(
    axis.text.x = element_text(
      angle = 45,
      hjust = 1,
      vjust = 0.5,
      size = 8
    ),
    axis.text.y = element_text(size = 7)
  ) +
  labs(
    x = "relativer Alkoholkonsum",
    y = "HIV Prävalenz in %",
    title = "Alkoholkonsum vs. HIV Prävalenz",
    subtitle = "Allgemeine Gruppierung"
  ) +
  theme(strip.text = element_text(size = 7, margin = margin(0.2, 0.2, 0.2, 0.2)))
```
<br>
Erkennbar sind hier nur ganz leichte Schwankungen der Verteilung. Nun wollen wir nochmal auf die Idee mit dem jährlichen gruppieren zurückkommen. 
<br>
```{r hiv_14, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
# Grouping by alcohol consumption values each year and saving this full dataset in data_hiv using function 2.2 group_data_year
data_alc_per_year <- data_alc %>%
  group_by(Year) %>%
  mutate(
    cat_alc_per_year =
      group_data_year(
        df = data_alc,
        grouping_by = "SH.ALC.PCAP.LI",
        year = Year,
        column_new = "alc_per_year",
        quantile_labels = c("Sehr gering", "Gering", "Mittel", "Groß", "Sehr groß")
      )$cat_alc_per_year
  )
```
<br>
Hier nun erstmal die Gruppierung geplottet:
<br>
```{r hiv_15, echo=FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc_per_year %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS)) +
  geom_point(aes(fill = cat_alc_per_year), size = 3, alpha = 0.5, shape = 21) +
  scale_fill_viridis_d(name = "relativer Alkoholkonsum", option = "plasma", direction = -1, guide = guide_legend(reverse = TRUE)) +
  geom_smooth(aes(group = 1), method = "lm", size = 0.8, colour = "black") +
  labs(
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz in %",
    title = "Gruppierung der Daten",
    subtitle = "Pro Jahr gruppierte Daten"
  ) +
  theme_bw()

data_alc_per_year_without_outlier <- data_alc_per_year %>% 
  filter(`Country Name` != "Tansania")
plot_alc_hiv_grouped_dotplot <- data_alc_per_year %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS)) +
  geom_point(size = 3.5, alpha = 0.5) +
  geom_smooth(aes(group = 1), method = "lm", se = FALSE, size = 1.2, colour = brewer.pal(3, "Set2")[[2]]) +
  geom_smooth(data = data_alc_per_year_without_outlier,
              method = "lm", se= FALSE, size = 1.2,
              colour = brewer.pal(3, "Set2")[[3]]) +
  labs(
    x = "Alkoholkonsum pro Kopf [l]",
    y = "HIV Prävalenz [%]",
    title = "Gruppierung der Daten mit jährlich gruppierten Daten"
  ) +
  theme_bw()+
  theme(axis.text = element_text(size = 14),
        axis.title.x = element_text(margin = margin(t = 10), size = 18),
        axis.title.y = element_text(margin = margin(r = 10), size = 18),
        plot.title = element_text(hjust = 0.5, size = 20))
```
<br>
Pro Jahr geplottete Daten zeigen die korrekte Einordnung der Quantile:
<br>
```{r hiv_16, echo=FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc_per_year %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS ,colour = cat_alc_per_year)) +
  facet_wrap( ~ Year) +
  geom_point(size = 2.5, alpha = 0.7) +
  labs(
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz in %",
    title = "Gruppierung der Daten",
    subtitle = "Pro Jahr gruppierte Daten",
    colour = "relativer Alkoholkonsum"
  ) +
  theme_bw() +
  scale_colour_brewer(palette = "Set2")
```
<br>
Nun pro Kategorie nur einen Punkt plotten.
<br>
```{r hiv_17, echo=FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc_per_year %>%
  group_by(Year, cat_alc_per_year) %>% 
  summarise(SH.ALC.PCAP.LI = mean(SH.ALC.PCAP.LI, na.rm = TRUE),
            SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
            .groups = "drop") %>% 
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS ,colour = cat_alc_per_year)) +
  facet_wrap( ~ Year) +
  geom_point(size = 2.5, alpha = 0.7) +
  labs(
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz in %",
    title = "Gruppierung der Daten",
    subtitle = "Pro Jahr gruppierte Daten",
    colour = "relativer Alkoholkonsum"
  ) +
  theme_bw() +
  scale_colour_brewer(palette = "Set2")
```
<br>
Zusammengelegt in einen plot würden die Daten folgendes ergeben:
<br>
```{r hiv_18, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc_per_year %>%
  group_by(cat_alc_per_year, Year) %>%
  summarise(
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SH.ALC.PCAP.LI = mean(SH.ALC.PCAP.LI, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS, colour = cat_alc_per_year)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_bw() +
  labs(
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz in %",
    title = "Alkoholkonsum vs. HIV Prävalenz im Schnitt über die Gruppierung",
    subtitle = "Pro Jahr gruppierte Daten",
    colour = "relativer Alkoholkonsum"
  ) +
  geom_smooth(aes(group = 1), method = "loess", se = FALSE, size = 0.8, span = 1.05) +
  scale_colour_brewer(palette = "Set2")
```
<br>
Um hier aber nochmal die Streuung der Werte beizubehalten, dieselben Daten nochmal in einem Boxplot dargestellt:
<br>
```{r hiv_19, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc_per_year %>%
  ggplot(aes(cat_alc_per_year, SH.DYN.AIDS.ZS)) +
  geom_boxplot(alpha = 0.7) +
  theme_bw() +
  labs(
    x = "relativer Alkoholkonsum",
    y = "HIV Prävalenz in %",
    title = "Alkoholkonsum vs. HIV Prävalenz",
    subtitle = "Pro Jahr gruppierte Daten",
    colour = "relativer Alkoholkonsum"
  )

data_alc_cat_n <- data_alc_per_year %>%
  group_by(cat_alc_per_year) %>%
  summarise(n = n())

plot_alc_hiv_boxplot <- data_alc_per_year %>%
  ggplot(aes(cat_alc_per_year, SH.DYN.AIDS.ZS)) +
  geom_boxplot(alpha = 0.7) +
  theme_bw() + 
  scale_x_discrete(labels = paste0(data_alc_per_year$cat_alc_per_year, "\nn = ", data_alc_cat_n$n)) +
  labs(
    x = "relativer Alkoholkonsum",
    y = "HIV Prävalenz [%]",
    title = "Alkoholkonsum vs. HIV Prävalenz - mit jährlich gruppierten Daten",
    colour = "relativer Alkoholkonsum"
  ) +
  theme(axis.text = element_text(size = 14),
        axis.title.x = element_text(margin = margin(t = 10), size = 18),
        axis.title.y = element_text(margin = margin(r = 10), size = 18),
        plot.title = element_text(hjust = 0.5, size = 20))
```
<br>
Wenn wir uns nun nochmal den Durchschnittsbarplot anschauen, nur dass die Daten jährlich neu gruppiert wurden, sieht dies nun so aus:
<br>
```{r hiv_20, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc_per_year %>%
  group_by(cat_alc_per_year) %>%
  summarise(SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
            .groups = "drop") %>%
  ggplot(aes(x = cat_alc_per_year, y = SH.DYN.AIDS.ZS)) +
  geom_col() +
  theme_bw() +
  labs(
    x = "relativer Alkoholkonsum",
    y = "HIV Prävalenz in %",
    title = "Alkoholkonsum vs. HIV Prävalenz im Schnitt über die Jahre",
    subtitle = "Pro Jahr neu gruppiert"
  )
```
<br>
Hier nun nochmal der plot, der durch die allgemeine Gruppierung hervorgerufen wurde, zum Vergleich:
<br>
```{r hiv_21, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_hiv %>%
  group_by(cat_alc) %>%
  summarise(SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
            .groups = "drop") %>%
  ggplot(aes(x = cat_alc, y = SH.DYN.AIDS.ZS)) +
  geom_col() +
  theme_bw() +
  labs(
    x = "relativer Alkoholkonsum",
    y = "HIV Prävalenz in %",
    title = "Alkoholkonsum vs. HIV Prävalenz im Schnitt über die Jahre",
    subtitle = "Allgemeine Gruppierung"
  )
```
<br>
Um hier auch nochmal die Gruppierung genauer zu betrachten, plotten wir die Daten inklusive Alkoholkonsumvariable:
<br>
```{r hiv_22, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc_per_year %>%
  group_by(cat_alc_per_year) %>%
  summarise(
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SH.ALC.PCAP.LI = mean(SH.ALC.PCAP.LI, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS, colour = cat_alc_per_year)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_bw() +
  labs(
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz in %",
    title = "Alkoholkonsum vs. HIV Prävalenz im Schnitt über die Jahre",
    subtitle = "Pro Jahr gruppierte Daten",
    colour = "relativer Alkoholkonsum"
  ) +
  geom_smooth(aes(group = 1), method = "lm", se = FALSE) +
  scale_colour_brewer(palette = "Set2")
```
<br>
Hier sehen wir nun die tatsächlich verbesserte Gruppierung sehr deutlich.
<br>
Wenn wir uns nun die Plots nach Jahr facettiert anschauen wollen mit der neuen Gruppierung, sieht das so aus:
<br>
```{r hiv_23, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc_per_year %>%
  group_by(cat_alc_per_year) %>%
  ggplot(aes(x = cat_alc_per_year, y = SH.DYN.AIDS.ZS)) +
  geom_col() +
  facet_wrap(~ Year) +
  theme_bw() +
  theme(
    axis.text.x = element_text(
      angle = 45,
      hjust = 1,
      vjust = 0.5,
      size = 6
    ),
    axis.text.y = element_text(size = 5)
  ) +
  labs(
    x = "relativer Alkoholkonsum",
    y = "HIV Prävalenz in %",
    title = "Alkoholkonsum vs. HIV Prävalenz",
    subtitle = "Pro Jahr gruppierte Daten"
  ) +
  theme(strip.text = element_text(size = 6, margin = margin(0.2, 0.2, 0.2, 0.2)))
```
<br>
Andererseits wollen wir die Daten auch nicht zu vereinfacht darstellen. Schließlich soll man noch erkennen, wie sich der Graph zusammensetzt. Hier nun also erstmal ein plot mit derselben Aussage über die Durchschnitte aller Jahre mit jährlich neu gruppierten Daten. Jedoch werden hier pro Jahr ein Punkt dargestellt und ein Polynom (LOESS Methode, span = 1.05) darüber gelegt.
<br>
```{r hiv_24, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc_per_year %>%
  group_by(cat_alc_per_year, Year) %>%
  summarise(
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SH.ALC.PCAP.LI = mean(SH.ALC.PCAP.LI, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS, colour = cat_alc_per_year)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_bw() +
  labs(
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz in %",
    title = "Alkoholkonsum vs. HIV Prävalenz im Schnitt über die Gruppierung",
    subtitle = "Pro Jahr gruppierte Daten",
    colour = "relativer Alkoholkonsum"
  ) +
  geom_smooth(aes(group = 1), method = "loess", se = FALSE, size = 0.8, span = 1.05) +
  scale_colour_brewer(palette = "Set2")
```
<br>
Schwierig ist hier, dass die Mittelwertsberechnun die Daten verziehen kann.
<br>
Hier wird nun pro Land im Schnitt über alle Jahre ein Punkt dargestellt und ein Polynom darüber gelegt.
<br>
```{r hiv_25, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc_per_year %>%
  group_by(cat_alc_per_year, `Country Name`) %>%
  summarise(
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SH.ALC.PCAP.LI = mean(SH.ALC.PCAP.LI, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS, colour = cat_alc_per_year)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_bw() +
  labs(
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz in %",
    title = "Alkoholkonsum vs. HIV Prävalenz im Schnitt über die Länder",
    subtitle = "Pro Jahr gruppierte Daten",
    colour = "relativer Alkoholkonsum"
  ) +
  geom_smooth(aes(group = 1), method = "loess", se = FALSE, span = 1.4) +
  scale_colour_brewer(palette = "Set2")
```
<br>
Problematisch ist hier, dass Länder die über die Jahre mehreren Kategorien angehören mehrere Datenpunkte als einen beanspruchen. 
Dadurch bekommen diese Datenpunkte mehr Gewicht.
<br>
Vergleichsweise hier nochmal mit allen Datenpunkten geplottet:
<br>
```{r hiv_26, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_alc_per_year %>%
  group_by(cat_alc_per_year) %>%
  ggplot(aes(SH.ALC.PCAP.LI, SH.DYN.AIDS.ZS, colour = cat_alc_per_year)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_bw() +
  labs(
    x = "Alkoholkonsum in Litern pro Kopf",
    y = "HIV Prävalenz in %",
    title = "Alkoholkonsum vs. HIV Prävalenz",
    subtitle = "Pro Jahr gruppierte Daten",
    colour = "relativer Alkoholkonsum"
  ) +
  geom_smooth(aes(group = 1), method = "loess", se = FALSE, span = 1.05) +
  scale_colour_brewer(palette = "Set2")
```
We see that Tansania shows a very high HIV Prevalence. We also see that there are no clear lines of our quantiles. This comes from grouping the data every year new. The quantile borders vary over time.
<br>
1. How does the HIV prevalence in the population aged 15-49 relate to the total alcohol consumption per capita?
<br>
Ganz allgemein ist erkennbar, dass mit Länder mit großem Alkoholkonsum im Schnitt über alle Jahre eine höhere HIV Prävalenz aufwiesen. Angemerkt sollte sein, dass dies nur im Schnitt erkennbar ist. Bei einer Analyse über Mediane ist diese Aussage nicht mehr zu treffen. Hier kommt eher hervor, dass Länder mit relativ gesehen größerem Alkoholkonsum eine höhere Varianz in ihrer HIV Prävalenz aufweisen.
<br>
<br>
### 2. HIV prevalence and basic education
<br>
```{r hiv_27, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_edu <- data_hiv %>%
  filter(`Country Name` != "China") %>%
  filter(`Country Name` != "Kasachstan")
```
<br>
To take a look at the grouping of our data by basic education of the working force, we will display a plot of the most recent data in Year 2021.
<br>
```{r hiv_28, echo=FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_edu %>%
  filter(Year == 2021) %>%
  ggplot(aes(`Country Name`, SL.TLF.BASC.ZS, colour = cat_education)) +
  geom_point(size = 3, alpha = 0.7) +
  labs(
    y = "Anteil an Arbeitenden mit grundlegender Bildung",
    x = "Land",
    title = "Gruppierung der Daten im Jahr 2021",
    colour = "relativer Anteil an Arbeitenden\nmit grundlegender Bildung"
  ) +
  theme_bw() +
  theme(axis.text.x = element_text(
    angle = 45,
    hjust = 1,
    size = 4
  )) +
  scale_colour_brewer(palette = "Set2")
```
<br>
Hier sehen wir erneut, dass es wohl sinnvoll wäre für jedes Jahr separat zu gruppieren. Dem werden wir uns später annehmen.
<br>
Now we take a look at the Comparison of percentage of the labor force with basic education and HIV prevalence in 2021. Therefore we group by the relative education level.
<br>
```{r hiv_29, echo=FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_edu %>%
  filter(Year == 2021) %>%
  group_by(cat_education) %>%
  ggplot(aes(SL.TLF.BASC.ZS, SH.DYN.AIDS.ZS, colour = cat_education)) +
  geom_point(size = 3, alpha = 0.7) +
  coord_cartesian(ylim = c(0, 1.75)) +
  theme_bw() +
  labs(
    x = "Anteil an Arbeitenden mit grundlegender Bildung",
    y = "HIV Prävalenz in %",
    title = "Bildungsstand vs. HIV Prävalenz im Jahr 2021",
    colour = "relativer Anteil an Arbeitenden\nmit grundlegender Bildung"
  ) +
  geom_smooth(aes(group = 1), method = "lm", se = FALSE) +
  scale_colour_brewer(palette = "Set2")
```
<br>
This plot is not very meaningful, therfore we try to only plot one dot per category.
<br>
```{r hiv_30, echo=FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_edu %>%
  filter(Year == 2021) %>%
  group_by(cat_education) %>%
  summarise(
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SL.TLF.BASC.ZS = mean(SL.TLF.BASC.ZS, na.rm = TRUE)
  ) %>%
  ggplot(aes(SL.TLF.BASC.ZS, SH.DYN.AIDS.ZS, colour = cat_education)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_bw() +
  labs(
    x = "Anteil an Arbeitenden mit grundlegender Bildung",
    y = "HIV Prävalenz in %",
    title = "Bildungsstand vs. HIV Prävalenz im Jahr 2021",
    colour = "relativer Anteil an Arbeitenden\nmit grundlegender Bildung"
  ) +
  geom_smooth(aes(group = 1), method = "lm", se = FALSE) +
  scale_colour_brewer(palette = "Set2")
```
<br>
Now we see a upwards tendency (even without the extreme value).
We notice as well that there is no value for the category "Medium" relative education. Therefore we take a look at 2020.
<br>
```{r hiv_31, echo=FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_edu %>%
  filter(Year == 2020) %>%
  group_by(cat_education) %>%
  ggplot(aes(SL.TLF.BASC.ZS, SH.DYN.AIDS.ZS, colour = cat_education)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_bw() +
  labs(
    x = "Anteil an Arbeitenden mit grundlegender Bildung",
    y = "HIV Prävalenz in %",
    title = "Bildungsstand vs. HIV Prävalenz im Jahr 2020",
    colour = "relativer Anteil an Arbeitenden\nmit grundlegender Bildung"
  ) +
  geom_smooth(aes(group = 1), method = "lm", se = FALSE) +
  scale_colour_brewer(palette = "Set2")
```
<br>
Is there still an downwards tendency, when each category is displayed only by one point?
<br>
```{r hiv_32, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_edu %>%
  filter(Year == 2020) %>%
  group_by(cat_education) %>%
  summarise(
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SL.TLF.BASC.ZS = mean(SL.TLF.BASC.ZS, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  ggplot(aes(SL.TLF.BASC.ZS, SH.DYN.AIDS.ZS, colour = cat_education)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_bw() +
  labs(
    x = "Anteil an Arbeitenden mit grundlegender Bildung",
    y = "HIV Prävalenz in %",
    title = "Bildungsstand vs. HIV Prävalenz im Jahr 2020",
    colour = "relativer Anteil an Arbeitenden\nmit grundlegender Bildung"
  ) +
  geom_smooth(aes(group = 1), method = "lm", se = FALSE) +
  scale_colour_brewer(palette = "Set2")
```
<br>
Unfortunately calculating with the mean of each group the graph is still upwards. Maybe plot over years to get an overview.
<br>
```{r hiv_33, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_edu %>%
  group_by(Year, cat_education) %>%
  summarise(
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SL.TLF.BASC.ZS = mean(SL.TLF.BASC.ZS, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  ggplot(aes(Year, SH.DYN.AIDS.ZS, colour = cat_education)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_bw() +
  theme(axis.text.x = element_text(
    angle = 45,
    hjust = 1,
    size = 6
  )) +
  labs(
    title = "HIV Prävalenz über die Jahre",
    x = "Jahr",
    y = "HIV Prävalenz",
    colour = "relativer Anteil an Arbeitenden\nmit grundlegender Bildung"
  )  +
  scale_colour_brewer(palette = "Set2")
```
<br>
The 60 % with higher education level also show a higher HIV Prevalence. Their Prevalence is falling over the years, while countries with lower education level have an small tendency to increasing HIV prevalence. The labor force with relativly medium
education have a higher HIV Prevalence than the others.
<br>
Now we take a look at all years, facetted by our categorization, all countries displayed
<br>
```{r hiv_34, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_edu %>%
  ggplot(aes(Year, SH.DYN.AIDS.ZS)) +
  geom_point(size = 2, alpha = 0.4) +
  facet_wrap(~ cat_education) +
  theme_bw() +
  labs(
    title = "HIV Prävalenz vs Grundbildung je nach relativem Anteil an Arbeitenden mit grundlegender Bildung",
    x = "Anteil grundlegend gebildeter Arbeitskräfte",
    y = "HIV Prävalenz",
    colour = "Land"
  )  +
  scale_colour_brewer(palette = "Set2")
```
<br>
We want to create a plot of the averages over all years grouped by education level. For interest first with x-axis education and second as bar plot (x axis the education level)
<br>
```{r hiv_35, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_edu %>%
  group_by(cat_education) %>%
  summarise(
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SL.TLF.BASC.ZS = mean(SL.TLF.BASC.ZS, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  ggplot(aes(SL.TLF.BASC.ZS, SH.DYN.AIDS.ZS, colour = cat_education)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_bw() +
  labs(
    x = "Anteil an Arbeitenden mit grundlegender Bildung",
    y = "HIV Prävalenz in %",
    title = "Bildungsstand vs. HIV Prävalenz im Schnitt über die Jahre",
    colour = "relativer Anteil an Arbeitenden\nmit grundlegender Bildung"
  ) +
  geom_smooth(aes(group = 1), method = "lm", se = FALSE) +
  scale_colour_brewer(palette = "Set2")
```
<br>
Hier sehen wir jedoch besonders stark, dass die Gruppierung so nicht akzeptabel ist.
<br>
Trotzdem plotten wir hier nochmal den Bar plot mit den Durchschnittswerten pro Kategorie.
<br>
```{r hiv_36, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_edu %>%
  group_by(cat_education) %>%
  summarise(
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    .groups = "drop"
    ) %>%
  ggplot(aes(x = cat_education, y = SH.DYN.AIDS.ZS)) +
  geom_col() +
  theme_bw() +
  labs(x = "relativer Anteil an Arbeitenden mit grundlegender Bildung", 
       y = "HIV Prävalenz in %", 
       title = "Bildungsstand vs. HIV Prävalenz im Schnitt über die Jahre")
```
<br>
Nun schauen wir uns bar plots facettiert nach Jahr an, um zu sehen, dass die Unterschiede der verschiedenen Gruppen betragsmäßig zurückgegangen sind. Die HIV-Prävalenz ist über die Jahre insgesamt gesunken, besonders aber bei Ländern mit ehemals den mit Abstand höchsten HIV Werten.
<br>
```{r hiv_37, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_edu %>%
  ggplot(aes(x = cat_education, y = SH.DYN.AIDS.ZS)) +
  geom_col() +
  facet_wrap( ~ Year) +
  theme_bw() +
  labs(
    x = "relativer Anteil an Arbeitenden mit grundlegender Bildung",
    y = "HIV Prävalenz in %",
    title = "Bildungsstand vs. HIV Prävalenz pro Jahr",
    subtitle = "Allgemeine Gruppierung"
  ) +
  theme(
    axis.text.x = element_text(
      angle = 90,
      hjust = 1,
      vjust = 0.5,
      size = 8
    ),
    axis.text.y = element_text(size = 8)
  ) +
  theme(strip.text = element_text(size = 10, margin = margin(0.2, 0.2, 0.2, 0.2)))
```
<br>
Und nun zu der jährlichen Gruppierungen:
<br>
```{r hiv_38, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
# Grouping by basic education values each year and saving this full dataset in data_edu using function 2.2 group_data_year
data_edu <- data_edu %>%
  group_by(Year) %>%
  mutate(
    cat_edu_per_year =
      group_data_year(
        df = data_edu,
        grouping_by = "SL.TLF.BASC.ZS",
        year = Year,
        column_new = "edu_per_year",
        quantile_labels = c("Sehr gering", "Gering", "Mittel", "Groß", "Sehr groß")
      )$cat_edu_per_year
  )
# sehr viele NA values in neuer Spalte cat_edu_per_year
data_edu <- data_edu %>% 
  filter(!is.na(cat_edu_per_year))
```
<br>
Als erstes wollen wir die Daten mit der neuen Gruppierung gefaceted anschauen:
<br>
```{r hiv_39, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_edu %>%
  ggplot(aes(x = SL.TLF.BASC.ZS, y = SH.DYN.AIDS.ZS, colour = cat_edu_per_year)) +
  geom_point(size =2.5, alpha = 0.7) +
  facet_wrap(~ Year) +
  theme_bw() +
  labs(
    x = "Anteil an Arbeitenden mit grundlegender Bildung",
    colour = "relativer Anteil an Arbeitenden\nmit grundlegender Bildung",
    y = "HIV Prävalenz in %",
    title = "Grundbildung vs. HIV Prävalenz",
    subtitle = "Pro Jahr neu gruppiert"
  ) +
  scale_colour_brewer(palette = "Set2")
```
<br>
Wenn wir uns nun nochmal den Durchschnittsbarplot anschauen, nur dass die Daten jährlich neu gruppiert wurden, sieht dies nun so aus:
<br>
```{r hiv_40, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_edu %>%
  group_by(cat_edu_per_year) %>%
  summarise(SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
            .groups = "drop") %>%
  ggplot(aes(x = cat_edu_per_year, y = SH.DYN.AIDS.ZS)) +
  geom_col() +
  theme_bw() +
  labs(
    x = "relativer Anteil an Arbeitenden mit grundlegender Bildung",
    y = "HIV Prävalenz in %",
    title = "Grundbildung vs. HIV Prävalenz im Schnitt über die Jahre",
    subtitle = "Pro Jahr neu gruppiert"
  )
```
<br>
Um hier auch nochmal die Gruppierung genauer zu betrachten, plotten wir die Daten inklusive Grundbildungsvariable:
<br>
```{r hiv_41, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_edu %>%
  group_by(cat_edu_per_year) %>%
  summarise(
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SL.TLF.BASC.ZS = mean(SL.TLF.BASC.ZS, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  ggplot(aes(SL.TLF.BASC.ZS, SH.DYN.AIDS.ZS, colour = cat_edu_per_year)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_bw() +
  labs(
    colour = "relativer Anteil an Arbeitenden\nmit grundlegender Bildung",
    y = "HIV Prävalenz in %",
    title = "Grundbildung vs. HIV Prävalenz im Schnitt über die Jahre",
    subtitle = "Pro Jahr neu gruppiert",
    x = "Anteil an Arbeitenden mit grundlegender Bildung"
  ) +
  scale_colour_brewer(palette = "Set2")
```

```{r hiv_42, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
hiv_plot_4 <- data_edu %>%
  group_by(cat_edu_per_year) %>%
  summarise(
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SL.TLF.BASC.ZS = mean(SL.TLF.BASC.ZS, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  ggplot(aes(SL.TLF.BASC.ZS,  SH.DYN.AIDS.ZS, colour = cat_edu_per_year)) +
  geom_point(size = 5, alpha = 0.7) +
  theme_bw(base_size = 19) +
  labs(
    colour = "relativer Anteil an Arbeitenden
    mit grundlegender Bildung",
    y = "HIV Prävalenz in %",
    title = "Grundbildung vs. HIV Prävalenz im Schnitt über die Jahre",
    subtitle = "Pro Jahr neu gruppiert",
    x = "Anteil an Arbeitenden mit grundlegender Bildung"
  ) +
  scale_colour_brewer(palette = "Set2")
```
<br>
Hier nun nochmal mit mehr Datenpunkten, dabei wird für jede Gruppierung pro Jahr ein Punkt für diese Mittelwerte geplottet:
<br>
```{r hiv_43, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_edu %>%
  group_by(cat_edu_per_year, Year) %>%
  summarise(
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SL.TLF.BASC.ZS = mean(SL.TLF.BASC.ZS, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  ggplot(aes(SL.TLF.BASC.ZS, SH.DYN.AIDS.ZS)) +
  geom_point(aes(fill = cat_edu_per_year), size = 3, alpha = 0.7, shape = 21) +
  scale_fill_viridis_d(name = "relativer Anteil an Arbeitenden\nmit grundlegender Bildung", option = "plasma", direction = -1, guide = guide_legend(reverse = TRUE)) +
  theme_bw() +
  labs(
    x = "Anteil der Erwerbstätigen mit grundlegender Bildung",
    y = "HIV Prävalenz in %",
    title = "Grundbildung vs. HIV Prävalenz im Schnitt über die Gruppierung",
    subtitle = "Pro Jahr gruppierte Daten"
  )

plot_edu_hiv_grouped_dotplot <- data_edu %>%
  group_by(cat_edu_per_year, Year) %>%
  summarise(
    SH.DYN.AIDS.ZS = mean(SH.DYN.AIDS.ZS, na.rm = TRUE),
    SL.TLF.BASC.ZS = mean(SL.TLF.BASC.ZS, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  ggplot(aes(SL.TLF.BASC.ZS, SH.DYN.AIDS.ZS)) +
  geom_point(size = 3.5, alpha = 0.5) +
  theme_bw() +
  labs(
    x = "Erwerbstätige mit grundlegender Bildung [%]",
    y = "HIV Prävalenz [%]",
    title = "Grundbildung vs. HIV Prävalenz - im Schnitt über die jährliche Gruppierung"
  ) +
  theme(axis.text = element_text(size = 14),
        axis.title.x = element_text(margin = margin(t = 10), size = 18),
        axis.title.y = element_text(margin = margin(r = 10), size = 18),
        plot.title = element_text(hjust = 0.5, size = 20))
```
<br>
Hier sehen wir nun die tatsächlich verbesserte Gruppierung sehr deutlich.
<br>
Wenn wir uns nun die Plots nach Jahr facettiert anschauen wollen mit der neuen Gruppierung, sieht das so aus:
<br>
```{r hiv_44, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_edu %>%
  group_by(cat_edu_per_year) %>%
  ggplot(aes(x = cat_edu_per_year, y = SH.DYN.AIDS.ZS)) +
  geom_col() +
  facet_wrap(~ Year) +
  theme_bw() +
  theme(
    axis.text.x = element_text(
      angle = 45,
      hjust = 1,
      vjust = 0.5,
      size = 9
    ),
    axis.text.y = element_text(size = 8)
  ) +
  labs(
    x = "relativer Anteil an Arbeitenden mit grundlegender Bildung",
    y = "HIV Prävalenz in %",
    title = "Grundbildung vs. HIV Prävalenz",
    subtitle = "Pro Jahr neu gruppiert"
  ) +
  theme(strip.text = element_text(size = 8, margin = margin(0.2, 0.2, 0.2, 0.2)))
```
<br>
Aber sind die Daten möglicherweise durch die Mittelwertsberechnun verzerrt? 
Hierzu schauen wir uns nun die Boxplots zu jeder Kategorie an:
<br>
```{r hiv_45, echo = FALSE, warning = FALSE, message = FALSE, fig.align = "left"}
data_edu %>%
  ggplot(aes(cat_edu_per_year, SH.DYN.AIDS.ZS)) +
  geom_boxplot(alpha = 0.7) +
  scale_y_log10() +
  theme_bw() +
  labs(
    x = "relativer Anteil an Arbeitenden mit grundlegender Bildung",
    y = "Logarithmierte HIV Prävalenz in %",
    title = "Grundbildung vs. HIV Prävalenz",
    subtitle = "Pro Jahr neu gruppiert"
  )

data_edu_cat_n <- data_edu %>%
  group_by(cat_edu_per_year) %>%
  summarise(n = n())

plot_edu_hiv_boxplot <- data_edu %>% 
  ggplot(aes(cat_edu_per_year, SH.DYN.AIDS.ZS)) +
  geom_boxplot(alpha = 0.7) +
  scale_y_log10() +
  theme_bw() + 
  scale_x_discrete(labels = paste0(data_edu$cat_edu_per_year, "\nn = ", data_edu_cat_n$n)) +
  labs(
    x = "Erwerbstätige mit grundlegender Bildung [%]",
    y = "HIV Prävalenz [%] (Log10)",
    title = "Grundbildung vs. HIV Prävalenz - mit jährlich gruppierten Daten"
  ) +
  theme(axis.text = element_text(size = 14),
        axis.title.x = element_text(margin = margin(t = 10), size = 18),
        axis.title.y = element_text(margin = margin(r = 10), size = 18),
        plot.title = element_text(hjust = 0.5, size = 20))
```
<br>
Do countries with higher percentage of labor force with basic education have lower HIV prevalence rates in the 15-49 population?
<br>
Aus den letzten 4 Grafen, lässt sich sehr deutlich herauslesen, dass sich bei einem größeren Anteil an Arbeitenden mit grundlegender Bildung eines Landes auch eine größere HIV Prävalenz beobachten lässt. Somit lässt sich diese Frage in Bezug auf die Daten verneinen.
<br>
2.3) boxplot with grouped countries by education and HIV prevalence values