---
title: "World Bank Agriculture Analysis"
author: "Robin Billinger"
date: "`r Sys.Date()`"
output:
  html_document:
    self-contained: true
    clean: true
    css: customstyle.scss
---

## Introduction
This analysis explores relationships between indicators across countries such as percentage of agricultural land, CO2 emissions per capita, and size of surface area using World Bank data. It is divided into two main parts, with this script focusing on the second question. For further observation of the first question, refer to the file 'Analysis/agriculture.Rmd'.
<br><br>
1. Is there a relationship between the percentage of agricultural land and CO2 emissions per capita across countries?
<br><br>
2. Does the **size of the surface area** of the country play a role?
<br>

```{r surface_setup, echo = FALSE, message = FALSE}
# Load libraries
library(knitr)
library(here)
library(dplyr)
library(ggplot2)
library(tidyr)
library(RColorBrewer)
library(scales)
library(patchwork)
library(grid)
library(ggradar) # not available for some newer R versions

# Globally center all plots while displaying knitted version in HTML
knitr::opts_chunk$set(fig.align = "center")

# Create dictionary table to get overview over variables to work with
# Variables:  Agricultural land (% of land area)
#             AG.LND.AGRI.ZS
#
#             Surface area (sq. km)
#             AG.SRF.TOTL.K2
#
#             Carbon dioxide (CO2) emissions (total) excluding LULUCF (Mt CO2e)
#             EN.GHG.CO2.MT.CE.AR5
#
#             Population, total
#             SP.POP.TOTL
dictionary <- data.frame(
  Variable = c("AG.LND.AGRI.ZS",
               "AG.SRF.TOTL.K2",
               "EN.GHG.CO2.MT.CE.AR5",
               "SP.POP.TOTL"),
  `Indicator Name` = c(
    "Agricultural land (% of land area)",
    "Surface area (sq. km)",
    "Carbon dioxide (CO2) emissions (total) excluding LULUCF (Mt CO2e)",
    "Population, total"),
  Definition = c(
    paste0("Agricultural land refers to the share of land area that is arable, under ",
           "permanent crops, and under permanent pastures. Arable land includes land ",
           "defined by the FAO as land under temporary crops (double-cropped areas are ",
           "counted once), temporary meadows for mowing or for pasture, land under ",
           "market or kitchen gardens, and land temporarily fallow. Land abandoned as a ",
           "result of shifting cultivation is excluded. Land under permanent crops is ",
           "land cultivated with crops that occupy the land for long periods and need ",
           "not be replanted after each harvest, such as cocoa, coffee, and rubber. ",
           "This category includes land under flowering shrubs, fruit trees, nut trees, ",
           "and vines, but excludes land under trees grown for wood or timber. ",
           "Permanent pasture is land used for five or more years for forage, including ",
           "natural and cultivated crops."),
    paste0("Surface area is a country's total area, including areas under inland bodies ",
           "of water and some coastal waterways."),
    paste0("A measure of annual emissions of carbon dioxide (CO2), one of the six Kyoto ",
           "greenhouse gases (GHG), from the building sector (subsector of the energy ",
           "sector) including IPCC 2006 codes 1.A.4 Residential and other sectors, ",
           "1.A.5 Non-Specified. The measure is standardized to carbon dioxide ",
           "equivalent values using the Global Warming Potential (GWP) factors of ",
           "IPCC's 5th Assessment Report (AR5)."),
    paste0("Total population is based on the de facto definition of population, which ",
           "counts all residents regardless of legal status or citizenship. The values ",
           "shown are midyear estimates.")),
  check.names = FALSE
)
kable(dictionary, caption = "World Bank Indicators", align = c("c", "c", "c"))

# Load the 'data_merged' data set using 'here'
data_surface <- readRDS(here("Data", "Processed", "data_merged.RDS"))

# Select relevant columns
data_surface <- data_surface %>%
  select(`Country Name`,
         `Country Code`,
         Year,
         SP.POP.TOTL,
         AG.SRF.TOTL.K2,
         AG.LND.AGRI.ZS,
         EN.GHG.CO2.MT.CE.AR5)

# Save the ascending order of average surface area
country_order_by_surface <- data_surface %>%
  group_by(`Country Name`) %>%
  summarise(avg_AG.SRF.TOTL.K2 = mean(AG.SRF.TOTL.K2)) %>%
  ungroup() %>%
  arrange(avg_AG.SRF.TOTL.K2) %>%
  pull(`Country Name`)
```

## Agenda
2.) Influence of surface area on previous relationship
<br><br>
2.1.) Radar chart of interested main variables
<br><br>
2.2.) Point-line plot of surface area with faceted countries
<br><br>
2.3.) Bar plot of absolute changes with faceted countries; changing countries
<br><br>
2.4.) Point-line plot of relative changes with faceted countries; changing countries
<br><br>
2.5.) Boxplot of surface area
<br><br>
2.6.) Scatter plot of interested variables with color scale and with faceted grouping
<br><br>
2.7.) Point-line plot of CO2 emissions with faceted grouping and color scale
<br><br>
2.8.) Point-line plot of interested variables with faceted grouping; normalized
<br><br>
2.9.) Point-line plot of interested variables with faceted countries; on per basis
<br><br>
2.10.) Point-line plot of interested variables with faceted grouping; on per basis
<br><br>
3.) Summary and Outlook

### 2. Influence of surface area on previous relationship
One further aspect that might change the non-relationship recorded in the 'agriculture.Rmd' file is the introduction of another variable to take into account, namely the countries' surface areas.

#### 2.1. Radar chart of interested main variables

Starting with the initial comparison between the variables within the ranges of the data observed, we get the following first overview.

```{r radar_agrLand_co2_surface, echo=FALSE, fig.height=6, fig.width=10, message=FALSE, warning=FALSE}
# Get an overview over surface data
summary(data_surface$AG.SRF.TOTL.K2)

# Radar chart for first overview of interaction of the three variables - bounded by
# country barriers set by the countries we are observing.
data_surface_radar <- data_surface %>%
  mutate(EN.GHG.CO2.MT.CE.AR5 = log10(EN.GHG.CO2.MT.CE.AR5 + 1),
         AG.SRF.TOTL.K2 = log10(AG.SRF.TOTL.K2 + 1)) %>%
  rename(log10_EN.GHG.CO2.MT.CE.AR5 = EN.GHG.CO2.MT.CE.AR5,
         log10_AG.SRF.TOTL.K2 = AG.SRF.TOTL.K2)

data_surface_radar <- data_surface_radar %>%
  group_by(`Country Name`) %>%
  summarize(across(matches("\\."), \(x) mean(x, na.rm = TRUE))) %>%
  mutate(across(matches("\\."), rescale)) %>%
  ungroup()

data_surface_radar <- data_surface_radar %>%
  pivot_longer(cols = matches("\\."), names_to = "Indicator", values_to = "Value") %>%
  pivot_wider(names_from = `Country Name`, values_from = Value)

ggradar(data_surface_radar,
        axis.label.size = 3,
        grid.label.size = 4,
        gridline.min.colour = "black",
        gridline.mid.colour = "black",
        gridline.max.colour = "black",
        group.line.width = 1,
        group.point.size = 2) +
  ggtitle("Indikatordaten im Zeitraum 2000 bis 2021",
          subtitle = paste0("Mittlere Indikatordaten pro Land pro Indikator für 0 bis ",
                            "100% der beobachteten Länder")) +
  scale_color_manual(
    name = "Indikatoren [%]",
    values = c("log10_AG.SRF.TOTL.K2" = brewer.pal(3, "Set2")[3],
               "log10_EN.GHG.CO2.MT.CE.AR5" = brewer.pal(3, "Set2")[2],
               "AG.LND.AGRI.ZS" = brewer.pal(3, "Set2")[1]),
    labels = c("log10_AG.SRF.TOTL.K2" = "Landesfläche (Log10)",
               "log10_EN.GHG.CO2.MT.CE.AR5" = "CO2 Emissionen pro Kopf (Log10)",
               "AG.LND.AGRI.ZS" = "Landwirtschaftliche Nutzfläche")) +
  theme_minimal() +
  theme(axis.text = element_blank(),
        legend.position = "right",
        legend.title = element_text(hjust = 0.5),
        legend.title.position = "top",
        panel.grid = element_blank())
```

#### 2.2. Point-line plot of surface area with faceted countries

```{r faceted_pointline_surface, echo=FALSE, fig.height=8, fig.width=12, message=FALSE, warning=FALSE}
# Point-line plot to get an overview of the surface area development within each country
# over time in ascending order of surface area occurrence
ggplot(data_surface, aes(x = Year, y = AG.SRF.TOTL.K2)) +
  geom_point() +
  ggtitle("Landesfläche nach Ländern") +
  scale_x_continuous(name = "Jahr",
                     breaks = seq(2000, 2020, by = 5),
                     minor_breaks = seq(2000, 2021, by = 1)) +
  scale_y_continuous(name = expression(Landesfläche ~ "[" ~ km^2 ~ "]")) +
  theme_bw() +
  theme(axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)),
        plot.title = element_text(hjust = 0.5)) + 
  facet_wrap(~ factor(`Country Name`, levels = country_order_by_surface),
             scales = "free_y")
```
<br>
As we can see, there are several countries with no changes in surface area throughout the interested time span at all. Therefore, before heading forward, we first want to zoom in a little closer on those with changes.

```{r changeless_countries, echo = FALSE, warning = FALSE, message = FALSE}
# Check in how many and which countries there is any change in surface area throughout
# the interested timespan
AG.SRF.TOTL.K2_countriesWithChange <- data_surface %>%
  group_by(`Country Name`) %>%
  summarize(noChange = all(AG.SRF.TOTL.K2 == AG.SRF.TOTL.K2[[1]])) %>%
  ungroup() %>%
  filter(!noChange) %>%
  pull(`Country Name`)
cat("Anzahl der Länder ohne Veränderungen: ", length(AG.SRF.TOTL.K2_countriesWithChange))

# Filter the data for only countries with changes in surface area
data_surface_change <- data_surface %>%
  filter(`Country Name` %in% AG.SRF.TOTL.K2_countriesWithChange) %>%
  select(`Country Name`, `Country Code`, Year, AG.SRF.TOTL.K2)
```

#### 2.3. Bar plot of absolute changes with faceted countries; changing countries

```{r changing_obs_absolute, echo=FALSE, fig.height=6, fig.width=10, message=FALSE, warning=FALSE}
# Investigate the absolute and relative changes for those countries from year to year
data_surface_change <- data_surface_change %>%
  # Ensure data is ordered by Country and Year
  arrange(`Country Name`, Year) %>%
  group_by(`Country Name`) %>%
  mutate(
    # Calculate changes
    Change = AG.SRF.TOTL.K2 - lag(AG.SRF.TOTL.K2),
    # Replace NAs for change from 1999 to 2000 with 0
    Change = ifelse(is.na(Change), 0, Change),
    # Absolute changes
    absChange = abs(AG.SRF.TOTL.K2 - lag(AG.SRF.TOTL.K2)),
    # Replace NAs for change from 1999 to 2000 with 0
    absChange = ifelse(is.na(absChange), 0, absChange),
    # Relative changes [%]
    relChange = ((AG.SRF.TOTL.K2 - lag(AG.SRF.TOTL.K2)) / lag(AG.SRF.TOTL.K2)) * 100,
    # Replace NAs for change from 1999 to 2000 with 0 %
    relChange = ifelse(is.na(relChange), 0, relChange)) %>%
  ungroup()

# Save the ascending order of average absolute change in surface area
country_order_by_surfaceAbs <- data_surface_change %>%
  group_by(`Country Name`) %>%
  summarise(avg_absChange = mean(absChange)) %>%
  arrange(avg_absChange) %>%
  ungroup() %>%
  pull(`Country Name`)

# Plot the changes in surface area for comparison between countries in order of ascending
# absolute changes
ggplot(data_surface_change, aes(x = Year)) +
  geom_bar(aes(y = Change, fill = Change < 0), stat = "identity") +
  geom_hline(yintercept = 0, linetype = "dashed") +
  ggtitle("Landesfläche in Ländern mit Veränderungen zwischen 2000 und 2021") +
  scale_x_continuous(name = "Jahr",
                     breaks = seq(2000, 2020, by = 5),
                     minor_breaks = seq(2000, 2021, by = 1)) +
  scale_y_continuous(
    name = expression(Absolute ~ Änderung ~ der ~ Landesfläche ~ "[" ~ km^2 ~ "]")
    ) +
  scale_fill_brewer(palette = "Set2", guide = "none") +
  theme_bw() +
  theme(axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)),
        panel.spacing.y = unit(1, "lines"),
        plot.title = element_text(hjust = 0.5)) +
  facet_wrap(~ factor(`Country Name`,
                      levels = country_order_by_surfaceAbs), ncol = 2, scales = "free_y")
```
<br>
For the vast majority of the countries, the changes can be classified as under 1000 square kilometers over the whole time span. Similar insights can be derived when looking at the relative changes.

#### 2.4. Point-line plot of relative changes with faceted countries; changing countries

```{r changing_obs_relative, echo=FALSE, fig.height=6, fig.width=10, message=FALSE, warning=FALSE}
# Save the ascending order of average relative change in surface area
country_order_by_surfaceRel <- data_surface_change %>%
  group_by(`Country Name`) %>%
  summarise(avg_relChange = mean(relChange)) %>%
  arrange(avg_relChange) %>%
  ungroup() %>%
  pull(`Country Name`)

# Plot the relative changes in surface area for comparison between countries
plot_changingObs_left <- ggplot(data_surface_change, aes(x = Year, y = relChange)) +
  geom_point() +
  scale_x_continuous(name = "Jahr",
                     breaks = seq(2000, 2020, by = 5),
                     minor_breaks = seq(2000, 2021, by = 1)) +
  scale_y_continuous(name = "Relative Änderung der Landesfläche [%]") +
  theme_bw() +
  theme(axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)),
        plot.title = element_text(hjust = 0.5)) + 
  facet_wrap(~ factor(`Country Name`, levels = country_order_by_surfaceRel), ncol = 2)

# Plot the relative changes in surface area with free y-scale to make minimal changes
# recognizable
plot_changingObs_right <- ggplot(data_surface_change, aes(x = Year, y = relChange)) +
  geom_point() +
  scale_x_continuous(name = "Jahr",
                     breaks = seq(2000, 2020, by = 5),
                     minor_breaks = seq(2000, 2021, by = 1)) +
  scale_y_continuous(name = "") +
  theme_bw() +
  theme(axis.title.x = element_text(margin = margin(t = 10)),
        plot.title = element_text(hjust = 0.5)) + 
  facet_wrap(~ factor(`Country Name`,
                      levels = country_order_by_surfaceRel), ncol = 2, scales = "free_y")

# Concatenate the two plots side by side
(plot_changingObs_left | plot_changingObs_right) + 
  plot_annotation(title = paste0("Landesfläche in Ländern mit Veränderungen ",
                                 "zwischen 2000 und 2021")) &
  theme(plot.title = element_text(hjust = 0.5))
```
<br>
For each country, even those with changes throughout the time span, there are at most marginal changes of two percent in surface area.

#### 2.5. Boxplot of surface area

To finally confirm those claims, we take a look at the scatter decomposition.

```{r boxplot_surface, echo=FALSE, fig.height=6, fig.width=10, message=FALSE, warning=FALSE}
# Compute the between-country variance in surface area
data_surface_variance_between_surface <-
  var(data_surface %>%
        group_by(`Country Name`) %>%
        summarise(avg_surface = mean(AG.SRF.TOTL.K2)) %>%
        ungroup() %>%
        select(avg_surface))

# Create boxplots for within-country variances
ggplot(data_surface,
       aes(x = log10(AG.SRF.TOTL.K2 + 1),
           y = factor(`Country Name`, levels = country_order_by_surface))) +
  geom_boxplot() +
  ggtitle("Streuungszerlegung der Landesfläche bezüglich Ländern") +
  scale_x_continuous(
    name = expression(Landesfläche ~ "[" ~ km^2 ~ "]" ~ (Log10)),
    breaks = log10(c(1000, 10000, 100000, 1000000, 10000000) + 1),
    labels = c("1.000", "10.000", "100,000", "1.000.000", "10.000.000")
    ) +
  scale_y_discrete(name = "Land") +
  theme_bw() +
  theme(axis.title.x = element_text(margin = margin(t = 10)),
        plot.title = element_text(hjust = 0.5))

cat("Streuung zwischen den Ländern: ", data_surface_variance_between_surface)
```
<br> 
In conclusion, we recognize that the changes in surface area are negligible over time. Therefore, we drop our focus on the development over time considering this variable when moving on. More interesting might be shifting the perspective towards whether the absolute amount of surface area has any influence on the relationship between agricultural land and CO2 emissions for the observed countries.
<br><br>

#### 2.6. Scatter plot of interested variables with color scale and with faceted grouping

For this exploration, we want to distinguish our countries into the following groups:
```{r scatter_grouped, echo=FALSE, fig.height=8, fig.width=14, message=FALSE, warning=FALSE}
# Load the grouping dictionary using 'here'
data_grouped <- readRDS(here("Data", "Processed", "data_grouped.RDS"))

# Select only grouping regarding the agriculture and surface area topic
data_grouped <- data_grouped %>% select(`Country Name`, `Country Code`, cat_surface_area)

# Join the grouping to the existing 'data_surface' data set
data_surface <- left_join(data_surface, data_grouped,
                          by = c("Country Name", "Country Code"))

# Plot the initial comparison via scatter plot, this time in grouped categories
ggplot(data_surface, aes(x = log10(EN.GHG.CO2.MT.CE.AR5 + 1), y = AG.LND.AGRI.ZS)) +
  geom_point(aes(fill = cat_surface_area), alpha = .5, size = 2.5, shape = 21) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  ggtitle(paste0("Zusammenhang zwischen CO2 Emissionen pro Kopf und ",
                 "landwirtschaftlicher Nutzfläche")) +
  scale_x_continuous(name = "CO2 Emissionen pro Kopf [Mt] (Log10)",
                     breaks = log10(c(0, 10, 100, 1000, 10000) + 1),
                     labels = c("0", "10", "100", "1.000", "10.000")) +
  scale_y_continuous(name = "Landwirtschaftliche Nutzfläche [%]") +
  scale_fill_viridis_d(name = "Landesfläche", direction = -1, option = "plasma") +
  theme_bw() +
  theme(axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)),
        legend.title = element_text(hjust = 0.5),
        plot.title = element_text(hjust = 0.5))

# Plot the initial comparison via scatter plot, faceted by the grouped categories
presentation_agriculture_plot2 <-
  ggplot(data_surface, aes(x = log10(EN.GHG.CO2.MT.CE.AR5 + 1), y = AG.LND.AGRI.ZS)) +
  geom_point(alpha = .3, size = 2.5) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  ggtitle(bquote("CO"[2] * " Emissionen pro Kopf vs. landwirtschaftliche Nutzfläche " *
                   "- mit Ländergruppen bezüglich deren Landesfläche")) +
  scale_x_continuous(name = expression(CO[2] ~ "Emissionen pro Kopf [Mt] (Log 10)"),
                     breaks = log10(c(0, 10, 100, 1000, 10000) + 1),
                     labels = c("0", "10", "100", "1.000", "10.000"),
                     limits = c(0, log10(max(data_surface$EN.GHG.CO2.MT.CE.AR5) + 1))) +
  scale_y_continuous(name = "Landwirtschaftliche Nutzfläche [%]",
                     limits = c(0, max(data_surface$AG.LND.AGRI.ZS))) +
  theme_bw() +
  theme(axis.text = element_text(size = 14),
        axis.title.x = element_text(margin = margin(t = 10), size = 16),
        axis.title.y = element_text(margin = margin(r = 10), size = 16),
        plot.title = element_text(hjust = 0.5, size = 19.5),
        strip.text = element_text(size = 14)) +
  facet_wrap(~ cat_surface_area, ncol = 3)

presentation_agriculture_plot2
```
<br>
We see there is no direct influence obvious through the grouping of the data. Let's dig deeper by looking at the time-specific distribution.

#### 2.7. Point-line plot of CO2 emissions with faceted grouping and color scale

```{r faceted_scatter_grouped, echo=FALSE, fig.height=6, fig.width=10, message=FALSE, warning=FALSE}
# Logarithmic CO2 emissions by country, average agricultural land [%] for color - faceted
# by groups
# Plot the upper row of the faceted scatter plot
ggplot(data_surface, aes(x = Year, y = log10(EN.GHG.CO2.MT.CE.AR5 + 1))) +
  geom_point(aes(fill = AG.LND.AGRI.ZS),
             alpha = 0.75, size = 2.5, shape = 21, stroke = 0.5) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  ggtitle(paste0("Zusammenhang zwischen CO2 Emissionen pro Kopf und ",
                 "landwirtschaftlicher Nutzfläche\nfür Ländergruppen bezüglich ",
                 "deren Landesfläche")) +
  scale_x_continuous(name = "Jahr",
                     breaks = seq(2000, 2020, by = 5),
                     minor_breaks = seq(2000, 2021, by = 1)) +
  scale_y_continuous(name = "CO2 Emissionen pro Kopf [Mt] (Log10)",
                     breaks = log10(c(0, 10, 100, 1000, 10000) + 1),
                     labels = c("0", "10", "100", "1.000", "10.000"),
                     limits = c(0, log10(max(data_surface$EN.GHG.CO2.MT.CE.AR5) + 1))) +
  scale_fill_viridis_c(name = "Landwirtschaftliche Nutzfläche [%]",
                       direction = -1, option = "plasma") +
  theme_bw() +
  theme(axis.text.x = element_text(hjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)),
        legend.position = "bottom",
        legend.title = element_text(vjust = 0.8),
        plot.title = element_text(hjust = 0.5)) +
  facet_wrap(~ cat_surface_area, ncol = 3)
```
<br>
The biggest anomalies regarding the CO2 emissions with the percentage of agricultural land in mind seem to be the moderate and very large surface area countries. Here on one hand, we can detect comparably high percentages in agricultural land for the moderate area countries, but those do not transfer themselves to any obvious differences in the CO2 emissions compared to the other groups. On the other hand, the very large countries stand out by having the supposedly expectable highest CO2 emissions among all groups. Marginal differences appear between the development over time, as the very large area countries are constant over the two decade timespan, while the other groups have slightly increasing trends.

#### 2.8. Point-line plot of interested variables with faceted grouping; normalized

If we finally pivot back to our normalized comparison we did earlier, we can do the same now with our grouped data according to the surface area categories.

```{r group-faceted scatterplot normalized, echo=FALSE, fig.height=7, fig.width=12, message=FALSE, warning=FALSE}
# (Min; Max)-normalize variable CO2 emissions to same scale as agricultural land [%] and
# normalize agricultural land to compare relative changes within both variables
data_surface_normd <- data_surface %>%
  group_by(`Country Name`) %>%
  mutate(
    co2_min = min(EN.GHG.CO2.MT.CE.AR5),
    co2_max = max(EN.GHG.CO2.MT.CE.AR5),
    co2_normd = ((EN.GHG.CO2.MT.CE.AR5 - co2_min) / (co2_max - co2_min)),
    agr_min = min(AG.LND.AGRI.ZS),
    agr_max = max(AG.LND.AGRI.ZS),
    agr_normd = ((AG.LND.AGRI.ZS - agr_min) / (agr_max - agr_min))
  ) %>%
  ungroup()

# Pivot normalized 'data_surface' data set to longer format for better visualization of
# two variables
data_surface_normd_long <- data_surface_normd %>%
  pivot_longer(cols = c(co2_normd, agr_normd),
               names_to = "variable", values_to = "value") %>%
  # Scale to [0, 100] [%] instead of [0, 1]
  mutate(value = value * 100)

# Plotting with normalized data over time for each group
presentation_agriculture_plot3 <-
  ggplot(data_surface_normd_long,
         aes(x = Year, y = value, group = interaction(`Country Name`, variable))) +
  geom_point(aes(fill = variable), alpha = 0.3, size = 2.5, shape = 21, stroke = 0.5) +
  geom_smooth(aes(group = variable),
              method = MASS::"rlm", se = FALSE, color = "black", size = 1.5) +
  geom_smooth(aes(group = variable, color = variable),
              method = MASS::"rlm", se = FALSE, size = 1, show.legend = FALSE) +
  ggtitle(bquote("CO"[2] * " Emissionen pro Kopf vs. landwirtschaftliche Nutzfläche " *
                   "- mit Ländergruppen bezüglich deren Landesfläche")) +
  scale_x_continuous(name = "Jahr",
                     breaks = seq(2000, 2020, by = 5),
                     minor_breaks = seq(2000, 2021, by = 1)) +
  scale_y_continuous(name = "Anteil [%]", limits = c(0, 100)) +
  scale_color_brewer(palette = "Set2") +
  scale_fill_brewer(name = "(Min; Max)-normalisierte Variablen:", palette = "Set2",
                    labels = c("Landwirtschaftliche Nutzfläche",
                               bquote("CO"[2] * " Emissionen pro Kopf"))) +
  theme_bw() +
  theme(axis.text = element_text(hjust = 0.5, size = 12),
        axis.title.x = element_text(margin = margin(t = 10), size = 14),
        axis.title.y = element_text(margin = margin(r = 10), size = 14),
        legend.margin = margin(t = 0),
        legend.position = "bottom",
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 14),
        plot.title = element_text(hjust = 0.5, size = 16.5),
        strip.text = element_text(size = 12)) +
  facet_wrap(~ cat_surface_area, ncol = 3)

presentation_agriculture_plot3
```

<br>
We cannot identify any obvious connection between the CO2 emissions per capita and the percentage of agricultural land even with the interested countries categorized by surface area.

#### 2.9. Point-line plot of interested variables with faceted countries; on per basis

```{r co2_perCapita_per_basis, echo=FALSE, fig.height=8, fig.width=12, message=FALSE, warning=FALSE}
# Form new variables by combining and distinguishing existing ones
data_surface <- data_surface %>%
  mutate(
    agrLand_absolute = (AG.LND.AGRI.ZS / 100) * AG.SRF.TOTL.K2,
    non_agrLand_absolute = AG.SRF.TOTL.K2 - agrLand_absolute,
    co2_pC_per_non_agrLand = EN.GHG.CO2.MT.CE.AR5 / non_agrLand_absolute,
    co2_pC_per_agrLand = EN.GHG.CO2.MT.CE.AR5 / agrLand_absolute,
    co2_per_non_agrLand = (EN.GHG.CO2.MT.CE.AR5 * SP.POP.TOTL) / non_agrLand_absolute,
    co2_per_agrLand = (EN.GHG.CO2.MT.CE.AR5 * SP.POP.TOTL) / agrLand_absolute,
    agrLand_per_capita = agrLand_absolute / SP.POP.TOTL
    )

data_surface_long <- data_surface %>%
  pivot_longer(
    cols = starts_with("co2"),
    names_to = "variable",
    values_to = "value",
  )

data_surface_long <- data_surface_long %>% 
  arrange(cat_surface_area, `Country Name`) %>%
  mutate(`Country Name` = factor(`Country Name`, levels = unique(`Country Name`)),
         facet_label = paste0(cat_surface_area, ": ", `Country Name`))

# Ensure that the new 'facet_label' is a factor and order it according to the original
# levels of 'cat_surface_area'
data_surface_long$facet_label <-
  factor(
    data_surface_long$facet_label,
    levels = unique(
      data_surface_long$facet_label[order(data_surface_long$cat_surface_area)]
      ))

# Plot the CO2 Emissions per capita per agricultural land [Kt / km^2] and surface area
# [Kt / km^2]
ggplot(data_surface_long
       %>% filter(variable %in% c("co2_pC_per_non_agrLand", "co2_pC_per_agrLand")),
       aes(x = Year,
           # Transform the CO2 emissions from Megatonnes to Kilotonnes
           y = value * 1000,
           group = interaction(`Country Name`, variable))) +
  geom_point(aes(fill = variable), alpha = 0.75, size = 2, shape = 21, stroke = 0.5) +
  ggtitle(paste0("Zusammenhang zwischen CO2 Emissionen pro landwirtschaftlicher ",
                 "Nutzfläche und pro Landesfläche nach Ländern")) +
  scale_x_continuous(name = "Jahr",
                     breaks = seq(2000, 2020, by = 5),
                     minor_breaks = seq(2000, 2021, by = 1)) +
  scale_y_continuous(name = "CO2 Emissionen pro Kopf [Kt]") +
  scale_fill_manual(name = "",
                    values = c(co2_pC_per_agrLand = brewer.pal(3, "Set2")[[1]],
                               co2_pC_per_non_agrLand = brewer.pal(3, "Set2")[[2]]),
                    labels = c(co2_pC_per_agrLand = expression(pro ~
                                                              landwirtschaftlicher ~
                                                              Nutzfläche ~
                                                              "[" ~ km^2 ~ "]"),
                               co2_pC_per_non_agrLand = expression(pro ~
                                                                  andere ~
                                                                  Flächen ~
                                                                  "[" ~ km^2 ~ "]"))) +
  theme_bw() +
  theme(axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)),
        legend.position = "bottom",
        plot.title = element_text(hjust = 0.5)) +
  facet_wrap(~ facet_label, scales = "free_y")
```

We recognize some similar developments over the years for the majority of countries between the CO2 emissions in Gigatonnes per square kilometer of agricultural land on one hand and per square kilometer of the country's surface area on the other hand.
<br>
Nevertheless, two appearing anomalies can be observed: Firstly, there are widely differing courses of co2 emissions between the per agricultural land and per surface area developments for some countries, namely being Aruba, Qatar, Finland, and Peru. Although the developments for the other countries are more or less differing as well, for these four countries the courses are by far the most. Categorized by very small (2x), small and large surface areas, conclusions stemming from the classification remain difficult. Conspicuous though, that all of these countries have noticeably low per surface area values with basically negligible increase, i.e. horizontal progression.
<br>
Secondly, the few countries with mainly decreasing values catch the eye, namely Czechia, Finland, the United Kingdom, Afghanistan, and the United States. Here we have very small, small (2x), middle and very large representations, again meaning there are no obvious differences between the classifications.

#### 2.10. Point-line plot of interested variables with faceted grouping; on per basis

Making it more representative by using the grouping for the faceting and investigating the relationship within the groups, shows the following.

```{r focused_co2_perCapita_per_basis, echo=FALSE, fig.height=7, fig.width=12, message=FALSE, warning=FALSE}
# Plot the CO2 Emissions per capita per agricultural land [Kt / km^2] and surface area
# [Kt / km^2] in grouped facets
presentation_agriculture_plot4 <-
  ggplot(data_surface_long
         %>% filter(variable %in% c("co2_pC_per_non_agrLand", "co2_pC_per_agrLand")),
         aes(x = Year,
             # Transform the CO2 emissions from Megatonnes to Kilotonnes
             y = value * 1000,
             group = interaction(`Country Name`, variable))) +
  geom_point(aes(fill = variable), alpha = 0.3, size = 2.5, shape = 21, stroke = 0.5) +
    geom_smooth(aes(group = variable),
              method = MASS::"rlm", se = FALSE, color = "black", size = 1.5) +
  geom_smooth(aes(group = variable, color = variable),
              method = MASS::"rlm", se = FALSE, size = 1, show.legend = FALSE) +
  ggtitle(bquote("CO"[2] * " Emissionen pro Kopf - mit Landergruppen bezüglich " *
                   "deren Landesfläche")) +
  scale_x_continuous(name = "Jahr",
                     breaks = seq(2000, 2020, by = 5),
                     minor_breaks = seq(2000, 2021, by = 1)) +
  scale_y_continuous(bquote("CO"[2] * " Emissionen pro Kopf [Kt]")) +
  scale_color_brewer(palette = "Set2") +
  scale_fill_manual(name = "",
                    values = c(co2_pC_per_agrLand = brewer.pal(3, "Set2")[[1]],
                               co2_pC_per_non_agrLand = brewer.pal(3, "Set2")[[2]]),
                    labels = c(co2_pC_per_agrLand = 
                                 expression(pro ~ landwirtschaftlicher ~ Nutzfläche ~
                                              "[" ~ km^2 ~ "]"),
                               co2_pC_per_non_agrLand =
                                 expression(pro ~ anderen ~ Flächen ~
                                              "[" ~ km^2 ~ "]"))) +
  theme_bw() +
  theme(axis.text = element_text(size = 12),
        axis.title.x = element_text(margin = margin(t = 10), size = 14),
        axis.title.y = element_text(margin = margin(r = 10), size = 14),
        legend.margin = margin(t = 0),
        legend.position = "bottom",
        legend.text = element_text(size = 14),
        plot.title = element_text(hjust = 0.5, size = 18),
        strip.text = element_text(size = 12)) +
  facet_wrap(~ cat_surface_area, scales = "free_y")

presentation_agriculture_plot4
```
For all of the classifications, the robust-linear relationships are slightly positive and progressing approximately parallel for both, the CO2 emissions in Gigatonnes per square kilometer of agricultural land as well as per square kilometer of surface area. However, the free y-scaling shows interesting deviations in the dimensions. While the very large countries also have the by far highest values for CO2 emissions, the other four categories are swapped, i.e. the values decrease with increasing surface area category. Especially the large category steps out of line with considerably fewer emissions than the others.

#### 2.11. ##############################################################################

```{r general_and_focused_co2_per_basis, echo=FALSE, message=FALSE, warning=FALSE}
# Doing the same two visualizations, only this time not for the per capita CO2 emissions
# but for the transformed total CO2 emissions per square kilometer of specified area

# Plot the CO2 Emissions per agricultural land [Kt / km^2] and surface area [Kt / km^2]
ggplot(data_surface_long
       %>% filter(variable %in% c("co2_per_non_agrLand", "co2_per_agrLand")),
       aes(x = Year,
           # Transform the CO2 emissions from Megatonnes to Kilotonnes
           y = value * 1000,
           group = interaction(`Country Name`, variable))) +
  geom_point(aes(fill = variable), alpha = 0.75, size = 2, shape = 21, stroke = 0.5) +
  ggtitle(paste0("Zusammenhang zwischen CO2 Emissionen pro landwirtschaftlicher ",
                 "Nutzfläche und pro Landesfläche nach Ländern")) +
  scale_x_continuous(name = "Jahr",
                     breaks = seq(2000, 2020, by = 5),
                     minor_breaks = seq(2000, 2021, by = 1)) +
  scale_y_continuous(name = "CO2 Emissionen pro Kopf [Kt]") +
  scale_fill_manual(name = "",
                    values = c(co2_per_agrLand = brewer.pal(3, "Set2")[[1]],
                               co2_per_non_agrLand = brewer.pal(3, "Set2")[[2]]),
                    labels = c(co2_per_agrLand = expression(pro ~
                                                              landwirtschaftlicher ~
                                                              Nutzfläche ~
                                                              "[" ~ km^2 ~ "]"),
                               co2_per_non_agrLand = expression(pro ~
                                                                  andere ~
                                                                  Flächen ~
                                                                  "[" ~ km^2 ~ "]"))) +
  theme_bw() +
  theme(axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)),
        legend.position = "bottom",
        plot.title = element_text(hjust = 0.5)) +
  facet_wrap(~ facet_label, scales = "free_y")

# And in the faceted grouping version
ggplot(data_surface_long
       %>% filter(variable %in% c("co2_per_non_agrLand", "co2_per_agrLand")),
         aes(x = Year,
             # Transform the CO2 emissions from Megatonnes to Kilotonnes
             y = value * 1000,
             group = interaction(`Country Name`, variable))) +
  geom_point(aes(fill = variable), alpha = 0.3, size = 2.5, shape = 21, stroke = 0.5) +
    geom_smooth(aes(group = variable),
              method = MASS::"rlm", se = FALSE, color = "black", size = 1.5) +
  geom_smooth(aes(group = variable, color = variable),
              method = MASS::"rlm", se = FALSE, size = 1, show.legend = FALSE) +
  ggtitle(paste0("Zusammenhang zwischen CO2 Emissionen pro landwirtschaftlicher ",
                 "Nutzfläche und pro Landesfläche\nfür Ländergruppen bezüglich ",
                 "deren Landesfläche")) +
  scale_x_continuous(name = "Jahr",
                     breaks = seq(2000, 2020, by = 5),
                     minor_breaks = seq(2000, 2021, by = 1)) +
  scale_y_continuous(name = "CO2 Emissionen pro Kopf [Kt]") +
  scale_color_brewer(palette = "Set2") +
  scale_fill_manual(name = "",
                    values = c(co2_per_agrLand = brewer.pal(3, "Set2")[[1]],
                               co2_per_non_agrLand = brewer.pal(3, "Set2")[[2]]),
                    labels = c(co2_per_agrLand = expression(pro ~
                                                              landwirtschaftlicher ~
                                                              Nutzfläche ~
                                                              "[" ~ km^2 ~ "]"),
                               co2_per_non_agrLand = expression(pro ~
                                                                  Landesfläche ~
                                                                  "[" ~ km^2 ~ "]"))) +
  theme_bw() +
  theme(axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)),
        legend.position = "bottom",
        plot.title = element_text(hjust = 0.5)) +
  facet_wrap(~ cat_surface_area, scales = "free_y")
```
